process {
    publishDir = [
	path: { "${params.outdir}/$sample" },
	mode: 'copy'
    ]
    withName: BUSCO {
        cpus   = 16
        memory = 64.GB
        time   = 12.h
	conda = "bioconda::busco=5.7.0"
	ext.args = "-l ${params.lineage}"
	container = 'https://depot.galaxyproject.org/singularity/busco:5.7.0--pyhdfd78af_1'
    }
    withName: CHECKM2 {
        cpus   = 8
        memory = 64.GB
        time   = 6.h
        conda  = "bioconda::checkm2=1.0.1 conda-forge::python=3.7.12"
	ext.args = [
            "--tmpdir ${params.tmp_dir}",
            "--database_path ${params.checkm2_db}"
        ].join(' ').trim()
	container = 'https://depot.galaxyproject.org/singularity/checkm2:1.0.1--pyh7cba7a3_0'
    }
    withName: CONCAT_DFS {
	conda  = "conda-forge::pandas=2.2.1"
	container = 'https://depot.galaxyproject.org/singularity/pandas:1.5.2'
    }
    withName: FINAL_DF {
        conda  = "conda-forge::pandas=2.2.1"
	container = 'https://depot.galaxyproject.org/singularity/pandas:1.5.2'
    }
    withName: GTDBTK2 {
        cpus   = 12
        memory = 64.GB
        time   = 24.h
	conda  = "bioconda::gtdbtk=2.3.2"
	ext.args = [
            "--mash_db ${params.mash_db}",
            "--tmpdir ${params.tmp_dir}"
        ].join(' ').trim()
	container = 'https://depot.galaxyproject.org/singularity/gtdbtk:2.3.2--pyhdfd78af_0'
    }
    withName: GUNC {
        cpus   = 12
        memory = 64.GB
        time   = 12.h
	conda  = "bioconda::gunc=1.0.6"
	ext.args = "-r ${params.gunc_db}"
	container = 'https://depot.galaxyproject.org/singularity/gunc:1.0.6--pyhdfd78af_0'
    }
    withName: QUAST {
        cpus   = 4
        memory = 16.GB
        time   = 6.h
	conda  = "bioconda::quast=5.2.0"
	ext.args = params.quast_options
	container = 'https://depot.galaxyproject.org/singularity/quast:5.2.0--py39pl5321h4e691d4_3'
    }
}
